# mdbook-htmx Docker Compose
# Base configuration for local development and CI testing
#
# Usage:
#   docker compose up -d          # Start services
#   docker compose logs -f        # View logs
#   docker compose down           # Stop services
#
# Overlays:
#   docker compose -f compose.yml -f compose.auth.yml up -d    # +Auth
#   docker compose -f compose.yml -f compose.search.yml up -d  # +Search

services:
  nginx:
    image: nginx:alpine
    container_name: mdbook-htmx
    ports:
      - "8080:80"
    volumes:
      - ../book/htmx:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/"]
      interval: 10s
      timeout: 5s
      retries: 3
    restart: unless-stopped

  # Live reload for development (optional)
  livereload:
    image: cosmtrek/air
    container_name: mdbook-htmx-reload
    profiles:
      - dev
    volumes:
      - ..:/app
    working_dir: /app
    command: >
      -c .air.toml

networks:
  default:
    name: mdbook-htmx
